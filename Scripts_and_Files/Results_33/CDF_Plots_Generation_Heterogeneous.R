################################################################################################################
################################################################################################################
####
#### CDF_Plots_Generation: # Script that generates a file containing a CDF plot. CDF: Cumulative Distributive
####                        Function. It is the figure associated to the Results 3.3 (Multiplex VS 
####                        Monoplex VS Heterogeneous VS Multiplex & Heterogeneous) section. Figure 4 in the manuscript. 
####                                          
################################################################################################################
################################################################################################################
####
#### 1. NAME: CDF_Plots_Generation.R 
#### 2. CONTENTS: Protocol to generate the CDF plots of the different options treated on the section Results 3.3
####              - Multiplex VS Heterogeneous and Multiplex & Heterogeneous
#### 3. CREATED: 07/12/2016 by Alberto Valdeolivas.
####
################################################################################################################
################################################################################################################
#### 4. DESCRIPTION: The script read the results obtained in LOOCV script, where ability to rank genes of RWR
####                 is tested in multiplex, heterogeneous and multiplex-heterogeneous situations. 
####                 With this data we generate a CDF and
####                 we display it focused in the first ranks (The method is focused on prioritization. Therefore
####                 that is the interesting part of the plot)
####       
################################################################################################################
################################################################################################################
#### 5. OUTPUT: A plot showing the different CDFs for the different multiplex/monoplex/heterogeneous approaches.
################################################################################################################
################################################################################################################
#### 6. EXAMPLE OF EXECUTION: Just Run it. Rscript CDF_Plots_Generation.R
####                          
################################################################################################################
################################################################################################################
rm(list=ls())

################################################################################################################
## 1.- We load the common network generation functions, and we install/load the packages needed. 
################################################################################################################
source("LOOCV_Utils.R")
CRAN.packages <- c("reshape2","plyr","ggplot2")
bioconductor.packages <- c()
install.packages.if.necessary(CRAN.packages, bioconductor.packages)

# We create a directoy called networks_files to save the files generated.
data.dir <- "Results_33/"
if (!file.exists(data.dir)) {
  dir.create(data.dir)
}

################################################################################################################
## 2.- We read the ranking results generated by the RWR algorithm in the different situations.
################################################################################################################

Input_Files_Monoplex <- read.table("Results_33/Monoplex.txt", header = TRUE, stringsAsFactors = FALSE)
# mean(Input_Files_Monoplex$Global_Ranking)
# [1] 3286.884

Input_Files_Multiplex <- read.table("Results_33/Multiplex.txt", header = TRUE, stringsAsFactors = FALSE)
# mean(Input_Files_Multiplex$Global_Ranking)
# [1] 2025.482

Input_Files_Heterogeneous <- read.table("Results_33/PPI_Heterogeneous.txt", header = TRUE, stringsAsFactors = FALSE)
# mean(Input_Files_Heterogeneous$Global_Ranking)
# [1] 1864.373

Input_Files_Multiplex_Heterogeneous <- read.table("Results_33/Multiplex_Heterogeneous.txt", header = TRUE, stringsAsFactors = FALSE)
# > mean(Input_Files_Multiplex_Heterogeneous$Global_Ranking)
# [1] 1237.537

################################################################################################################
## 3.- We generate a data frame with all the rankings we are going to take in account. We calculate CDF
################################################################################################################
Monoplex <- Input_Files_Monoplex$Global_Ranking
Multiplex <- Input_Files_Multiplex$Global_Ranking
Heterogeneous <- Input_Files_Heterogeneous$Global_Ranking
Multiplex_Heterogeneous <- Input_Files_Multiplex_Heterogeneous$Global_Ranking
  
ggdata <- data.frame(Monoplex,Multiplex,Heterogeneous,Multiplex_Heterogeneous)

ggdata <- melt(ggdata)
ggdata <- ddply(ggdata, .(variable), transform, ecd=ecdf(value)(value))

################################################################################################################
## 4.- We plot the results.
################################################################################################################
cdf <- ggplot(ggdata, aes(x=value)) + stat_ecdf(aes(colour=variable,linetype=variable),size = 1.75) +xlab("Rank") + 
  ylab("Cumulative Distribution") +theme_bw() +   theme(axis.text=element_text(size=16),
                                    axis.title=element_text(size=18,face="bold"), legend.title=element_blank(),
                                    legend.text = element_text(size = 16, face = "bold"), 
                                    legend.position=c(0.75,0.2), legend.key.size = unit(1.8, "cm"), 
                                    legend.background = element_rect(colour='black',size=0.5),
                                    panel.grid.major = element_line(size = 0.5, colour = 'black',linetype='dotted'),  
                                    panel.border=element_rect(size=0.75,colour='black')) 
# legend.background = element_blank()
cdf

cdf + coord_cartesian(xlim = c(1, 60), ylim = c(0,0.55)) 
ggsave("../Figures_V2/Figure_4.jpg")


